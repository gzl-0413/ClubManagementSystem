@model ClubManagementSystem.Models.Announcement

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Add Announcement</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        h2 {
            text-align: center;
            margin-top: 20px;
            color: #333;
        }

        .announcement-form {
            max-width: 700px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            font-weight: bold;
            color: #333;
            display: block;
            margin-bottom: 8px;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

            .form-control:focus {
                outline: none;
                border-color: #007bff;
            }

        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            margin-bottom: 10px;
        }

            .btn:hover {
                background-color: #0056b3;
            }

        .alert {
            padding: 15px;
            margin-top: 20px;
            background-color: #f8d7da;
            color: #721c24;
            border-radius: 4px;
        }

            .alert ul {
                margin: 0;
                padding: 0;
                list-style-type: none;
            }

            .alert li {
                margin: 5px 0;
            }

        #PostLaterFields {
            margin-top: 15px;
        }

        .form-check {
            margin-right: 10px;
        }

        /* Image preview styles */
        .image-preview-container {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .image-preview {
            max-width: 100px;
            max-height: 100px;
            display: none;
        }
    </style>
</head>
<body>
    <h2>Add Announcement</h2>

    <form asp-action="AnnAdd" asp-controller="Announcement" method="post" enctype="multipart/form-data" class="announcement-form">
        <div class="form-group">
            <label asp-for="Title" class="form-label"></label>
            <input asp-for="Title" class="form-control" />
            <span asp-validation-for="Title" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Content" class="form-label"></label>
            <textarea asp-for="Content" class="form-control"></textarea>
            <span asp-validation-for="Content" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label class="form-label">Upload Photos (Max 3)</label>
            <input type="file" name="Photos" class="form-control" multiple id="photoInput" />
        </div>

        <!-- Image preview container -->
        <div class="form-group">
            <div class="image-preview-container" id="imagePreviewContainer"></div>
        </div>

        <!-- Choose Post Time using Radio Buttons -->
        <div class="form-group">
            <label class="form-label">Choose Post Time</label><br />
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="PostOption" id="PostNow" value="now" checked />
                <label class="form-check-label" for="PostNow">Post Immediately</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="PostOption" id="PostLater" value="later" />
                <label class="form-check-label" for="PostLater">Post Later</label>
            </div>
        </div>

        <!-- Post Later Date and Time -->
        <div class="form-group" id="PostLaterFields" style="display:none;">
            <label for="PostDate" class="form-label">Select Date and Time</label>
            <input type="datetime-local" name="PostDate" class="form-control" />
        </div>

        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger">
                @TempData["Error"]
            </div>
        }

        <button type="submit" class="btn btn-primary">Submit</button>

        <!-- Cancel Button -->
        <button type="button" class="btn btn-secondary" id="cancelButton">Cancel</button>
    </form>

    <script>
                // Disable calendar with date earlier than today
        document.addEventListener("DOMContentLoaded", function () {
            var currentDate = new Date();
            var year = currentDate.getFullYear();
            var month = ("0" + (currentDate.getMonth() + 1)).slice(-2); // Add leading zero for month
            var day = ("0" + currentDate.getDate()).slice(-2); // Add leading zero for day
            var hours = "00"; // Midnight for the start of the day
            var minutes = "00"; // 00 minutes
            var minDateTime = year + "-" + month + "-" + day + "T" + hours + ":" + minutes;

            // Get the input field for PostDate and set the min attribute
            var postDateInput = document.querySelector('input[name="PostDate"]');
            if (postDateInput) {
                postDateInput.setAttribute("min", minDateTime);
            }
        });

        // Toggle the visibility of date-time picker based on 'Post Later' radio button
        document.getElementById("PostNow").addEventListener("change", function () {
            var postLaterFields = document.getElementById("PostLaterFields");
            if (this.checked) {
                postLaterFields.style.display = "none";
            }
        });

        document.getElementById("PostLater").addEventListener("change", function () {
            var postLaterFields = document.getElementById("PostLaterFields");
            if (this.checked) {
                postLaterFields.style.display = "block";
            }
        });

        // Confirm cancellation and navigate to AnnList if confirmed
        document.getElementById("cancelButton").addEventListener("click", function () {
            var userConfirmed = confirm("Are you sure you want to cancel? All unsaved changes will be lost.");
            if (userConfirmed) {
                window.location.href = '@Url.Action("AnnList", "Announcement")';  // Redirect to AnnList
            }
        });

        // Preview the selected images and limit to 3 images
        document.getElementById("photoInput").addEventListener("change", function (event) {
            var files = event.target.files;
            var previewContainer = document.getElementById("imagePreviewContainer");

            // Clear previous previews
            previewContainer.innerHTML = '';

            if (files.length > 3) {
                alert("You can select a maximum of 3 photos.");
                event.target.value = "";  // Clear the selection
                return;
            }

            // Loop through selected files and create image previews
            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                var reader = new FileReader();

                reader.onload = function (e) {
                    var img = document.createElement("img");
                    img.src = e.target.result;
                    img.classList.add("image-preview");
                    img.style.display = "block";  // Make image visible
                    previewContainer.appendChild(img);
                };

                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>
